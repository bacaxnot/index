---
import BlogPostHeader from '@/components/blog-post-header.astro'
import Base from '@/layouts/base.astro'
import { supabaseClient } from '@/lib/supabase/client'

export const prerender = false

const supabase = supabaseClient({ env: 'server', cookies: Astro.cookies })
const { data: posts } = await supabase.from('posts').select('*, user:users(*)')

if (posts == null) return Astro.redirect('/404')
const { slug } = Astro.params

const post = posts.find((post) => post.slug === slug)
if (post == undefined) return Astro.redirect('/404')
---

<Base title={`bacaxnot / ${post.title} / raw`}>
	<article class="grid gap-12">
		<BlogPostHeader post={post} mode="dev" />
		<pre class="whitespace-pre-wrap break-all">{JSON.stringify(post, null, 2)}</pre>
	</article>
</Base>
